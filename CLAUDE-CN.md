# CLAUDE-CN.md

**🔥 强制要求：**

- **语言：所有交流必须使用中文，包括 bmad 代理、CCPlugins 命令和任何工具调用的对话**
- **文件读取：项目内文件必须使用 Claude 内置 Read 工具，禁用 mcp__filesystem__*工具**

本文件定义了本项目不可变的规则、语义契约和 AI 执行约束。

这是一部宪法，不是变更日志，不是笔记本，也不是讨论记录。

所有人类和 AI 的变更都必须遵守本文件。

---

## 1. 适用范围与权威性

本宪法适用于：

- frontend/
- backend/（如存在）
- 项目整体的语义结构、AEO 设计与文档治理体系

所有人类开发者与 AI Agent（Claude / Codex / Cursor / Trae）
**必须遵守本文件中的规则。**

如本文件与其他说明发生冲突，**以 CLAUDE.md 为最高优先级**。

---

## 2. 内容与语义宪法

### 2.1 页面职责定义

> 每个页面类型必须遵循单一、不重叠的语义职责。

#### 课程页面（/course/）
课程页面表示**一门独立的教学单元**。

- 说明：课程教什么、学什么、产出什么
- 包含：课程内容、技能目标、学习成果、章节结构
- **禁止**：定义学习顺序或学习路径

**职责边界**：
- ✅ 回答"这门课程教什么？"
- ❌ 不能解释全局学习阶段
- ❌ 不能定义学习顺序

---

#### 主题页（/t/{topic}）
主题页用于**按主题聚合课程**。

- 只负责"内容相关性"
- 不表达先后顺序
- **禁止**：表现为体系课或路径

**职责边界**：
- ✅ 聚合同主题的课程
- ❌ 不能定义学习顺序
- ❌ 不能使用 hasPart 关系

---

#### 体系课页（/programs/{program}）
体系课页面，表示**有明确顺序的学习路径**。

- 课程是有意排序的
- 用于表达"先学什么 → 再学什么"
- 是结构化学习的核心单位

**职责边界**：
- ✅ 回答"应该先学什么，再学什么，为什么？"
- ✅ 定义课程顺序和前置条件
- ❌ 不能重新定义学习阶段含义
- ❌ 不能重复课程内容

---

#### 路径页（/paths/{path}）
路径页用于**宏观学习路线聚合**。

- 可以聚合多个体系课
- 不取代体系课的顺序定义

---

#### 学习阶段页（/levels/）
学习阶段定义页，仅用于解释阶段语义。

- 学习阶段是枚举，不是课程
- 不承载具体教学内容

**职责边界**：
- ✅ 回答"初级/中级/高级是什么意思？"
- ✅ 解释学习者前置条件、预期技能、学习难度
- ✅ 聚合该阶段的课程
- ❌ 不能教授具体课程内容

---

#### 常见问答 / 教程页
用于问答与教程型搜索。

- **禁止**：重新定义课程或体系课语义

---

### 2.2 实体关系规则（AEO）

所有实体关系必须遵循 Schema.org 和 AEO 安全语义。

#### 强制关系

**体系课 ↔ 课程**：
- 体系课 → 课程：hasPart（包含部分）
- 课程 → 体系课：isPartOf（属于）

**主题 ↔ 课程**：
- 主题 → 课程：about / mentions（关于/提及）

#### 禁止关系

- ❌ 主题页禁止使用 hasPart
- ❌ 课程禁止在体系课上下文之外定义 position
- ❌ 体系课禁止作为无序聚合容器

---

### 2.3 命名与枚举规则（唯一真源）

#### 学习阶段枚举（唯一合法枚举）

```
beginner | intermediate | advanced
初级     | 中级          | 高级
```

- `basic` **已被禁用**
- 枚举值必须在以下位置完全一致：
  - URL slug
  - UI 文案
  - JSON-LD
  - 内部数据模型

**运行时校验**：
- 阶段数据进入 store、路由或组件前应调用 `assertStageKey`
- 保持快速失败原则
- 新增工具/接口需沿用 `assertStageKey` 策略，避免静默回退

---

#### Slug 规则

- Slug 必须具有语义性、稳定性和可读性
- Slug 禁止编码临时 UI 状态
- Slug 含义必须与内容含义匹配

**SEO/AEO 优化原则**：
- ✅ 允许使用拼音：TypeScript 类型定义、组件内部变量名
- ❌ 禁止使用拼音：URL 路径、HTML class/id、Schema.org 数据、图片文件名、Meta 标签

**课程 Slug 格式**：
- 格式：`{主题}-{工具}-{阶段}`
- 阶段部分：必须使用系统定义的阶段术语（`beginner` / `intermediate` / `advanced`）
- 示例：`photoshop-ai-design-beginner`

---

## 3. 路由与 URL 规范规则

### URL 层级结构

- `/course/`：原子教学单元
- `/t/`：主题聚合
- `/programs/`：有序学习路径
- `/paths/`：宏观学习路线
- `/levels/`：学习阶段定义

### 规范规则

- 每个实体只有一个规范 URL
- Slug 变更必须提供重定向
- 影响索引的路由变化必须记录在 CHANGELOG.md

### Slug 稳定性原则

- slug ≠ 展示用：Slug 不是用于展示，而是用于语义锚定
- slug = 长期稳定语义锚点：Slug 应随时间保持稳定以维护 SEO 价值
- SEO / AEO 优先：Slug 必须遵循 AEO / LRMI 最佳实践

---

## 4. 数据与 Schema 规则（Schema / LRMI）

### Schema 真实表达原则

- 所有课程 / 体系课 / 学习阶段页面必须提供 JSON-LD
- Schema 必须与页面内容真实一致
- 禁止夸大技能、成果或前置条件

**禁止行为**：
- ❌ 禁止虚假声明：JSON-LD 必须准确反映实际课程内容
- ❌ 不得过度宣称：禁止夸大技能、成果或前置条件

### educationalLevel 使用规则

- **必须使用 DefinedTerm**：避免使用纯字符串，使用结构化的 DefinedTerm 格式
- **必须引用学习阶段实体**：使用 `@id` 或 `inDefinedTermSet` 链接到 `/levels/` 页面

**示例**：
```json
"educationalLevel": {
  "@type": "DefinedTerm",
  "name": "初级",
  "@id": "https://www.doviai.com/levels/beginner"
}
```

### 体系课 / 课程 / 技能关系规则

- **isPartOf / hasPart**：使用这些属性定义层级关系
- **programPrerequisites**：为体系课页面明确定义前置条件
- **educationalUse**：使用 LRMI educationalUse 值对内容类型进行分类

LRMI 仅用于教育语义字段（如 educationalLevel）。

---

## 5. 编码哲学与架构约束

以下原则为**长期约束**：

### 核心原则

- **显式优于隐式**：明确表达优于隐式推断
- **状态必须可追溯、可调试**：状态的可追溯性和可调试性
- **避免将业务语义编码进 UI 表现层**：避免将业务语义与表现逻辑耦合
- **禁止同一概念存在多个真源**：每个概念只有一个真源

### 数据模型原则

- **课程**：包含具体的课程内容、课时、成果和元数据
- **学习阶段**：定义学习阶段特征、前置条件，并聚合课程
- **体系课**：定义学习路径，连接多个课程，并解释进阶逻辑

**单一真源规则**：
- 学习阶段定义：只能在 `/levels/` 页面定义，其他地方引用
- 课程数据：必须集中在课程存储中，使用一致的标识符
- 体系课结构：必须在体系课存储中定义，引用现有课程和学习阶段

### 反模式（禁止）

- ❌ 同一概念存在双重真源
- ❌ 在表现逻辑中重新编码语义含义
- ❌ 隐藏的全局状态
- ❌ 混合页面职责（例如，在课程页面解释"初级"的含义）

---

## 6. AI 与 Agent 执行规则（AI 行为红线）

### AI Agent 允许的操作

- 重构代码（不破坏语义）
- 提出 AEO / Schema 优化建议
- 遵循语义边界并尊重页面角色定义
- 使用现有模式和已建立的代码模式

### AI Agent 禁止的操作

- 静默修改 URL / slug / 实体语义
- 引入新的学习阶段或实体类型
- 删除或弱化本宪法中的规则
- 未经明确批准发明新概念
- 创建新的学习阶段名称（只能使用 `beginner`、`intermediate`、`advanced`）

### 审查要求

- 所有 AI 修改必须可审查、可回滚
- 所有规则变更必须记录在 CLAUDE.md 中
- 必须记录变更原因和影响
- 必须尽可能保持向后兼容性

---

## 7. 工具与插件治理

### 治理规则

- MCP / CCPlugins 需显式启用
- 禁止自动安装、自动执行
- 影响代码或数据的工具必须人工确认

### 激活条件

- 工具激活必须是有意的
- 禁止自动安装或执行
- 影响代码或数据的工具必须获得明确的人工同意

操作教程不属于本文件范围。

---

## 8. 文档系统与同步规则（文档分工）

### 8.1 文档职责

- **CLAUDE.md**：规则与红线（宪法）
  - 不可变的规则和约束
  - 语义原则和页面角色
  - AEO 指南和架构约束

- **CHANGELOG.md**：发生了什么（历史）
  - 可观察的系统变更
  - 实现细节
  - 功能、错误修复和迁移

- **frontend/docs/**：PRD、讨论、执行过程、测试与验证
  - PRD 和设计决策
  - 执行日志和测试报告
  - 验证和确认记录

### 8.2 同步原则

- 规则变化 → 更新 CLAUDE.md
- 可观测变化 → 更新 CHANGELOG.md
- 过程细节 → 更新 docs/

**同步协议**：
- 规则变更 → 更新 `CLAUDE.md`
- 可观察行为变更 → 更新 `CHANGELOG.md`
- 过程细节 → 更新 `frontend/docs/`

文档职责禁止重复。

---

## 9. 执行与审查协议

### 违规处理

- 所有违反本宪法的修改必须被修正
- 临时例外需显式记录
- 审查清单必须引用本文件

### 审查要求

- 违反本宪法的行为必须被纠正
- 临时例外需要明确的文档记录
- 审查清单必须引用本文件

---

## 附录（非规范性）

本节内容仅供说明与预案使用，不具备强制约束力。

### JSON-LD 结构示例

#### 课程页面 JSON-LD 示例
```json
{
  "@context": "https://schema.org",
  "@type": "Course",
  "name": "AI Photoshop 设计初级课程",
  "description": "学习 AI 驱动的 Photoshop 设计基础。",
  "educationalLevel": {
    "@type": "DefinedTerm",
    "name": "初级",
    "@id": "https://www.doviai.com/levels/beginner"
  },
  "educationalUse": ["讲座", "演示", "练习"],
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "CNY",
    "availability": "https://schema.org/InStock"
  }
}
```

#### 学习阶段页面 JSON-LD 示例
```json
{
  "@context": "https://schema.org",
  "@type": "DefinedTermSet",
  "name": "学习阶段",
  "hasDefinedTerm": [
    {
      "@type": "DefinedTerm",
      "name": "初级",
      "description": "适合零基础学员，提供软件基础和快速理解的免费课程。",
      "url": "https://www.doviai.com/levels/beginner"
    }
  ]
}
```

### 常见错误案例

1. **混合页面职责**：例如，在课程页面解释"初级"的含义
2. **使用错误的阶段术语**：在 slug 或结构化数据中使用 `basic` 而不是 `beginner`
3. **虚假的 Schema.org 声明**：声称教授课程中实际未涵盖的技能
4. **语义重叠**：体系课页面重复课程内容，而不是专注于学习顺序
5. **忽略单一真源**：在多个地方定义学习阶段含义

### 未来实体提案

（本节预留用于未来实体草案）

---

## 最终原则

> **`CLAUDE.md（根目录） = 项目的语义宪法`**
> **`frontend/CLAUDE.md = 前端执行细则`**

本文件定义了指导所有开发决策的核心语义原则。
所有 AI agent、贡献者和未来的重构者都必须遵守这些规则，以保持
一致的 AEO / LRMI 语义对齐和最佳的搜索引擎理解。

---

*版本：2.0.0*
*最后重构：2025-12-21*
