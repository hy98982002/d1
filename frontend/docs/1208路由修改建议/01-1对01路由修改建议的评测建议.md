## 评测概览

你的 **01路由修改建议.md** 已经把「硬编码 `/program/…` → 动态 `/program/:slug`」的核心思路、待改文件及示例代码写得相当完整。整体方向正确，尤其是先合并 ProgramA/B 视图并集中管理 Program 配置的数据层设计，能显著降低后期维护成本。下面针对 **vite-plugin-ssr 下的 SPA ➜ SPA + SSG 混合模式** 再补充一些可提升的细节与潜在风险。

---

### 1  路由与文件组织

| 建议                      | 说明                                                                                                                       |
| ----------------------- | ------------------------------------------------------------------------------------------------------------------------ |
| **采用 page-file 命名规范**   | 在 vite-plugin-ssr 中应改为 `/pages/program/[slug]/+Page.vue` 或 `[slug].page.vue`，借助官方的 *pageFiles* 自动路由，而非手动 `createRouter`。 |
| **删除 `beforeEnter` 守卫** | 在 SSG 场景可用 `onBeforeRender()` 里校验 slug，失败时返回 404；运行时守卫只在 CSR fallback 阶段才生效，避免双重逻辑。                                      |
| **为未知 slug 输出静态 404**   | 在 `prerender()` 里返回 `{ pageContext: { is404: true } }`，结合 `404.page.vue`；保证生产站点不会因 slug 拼写错误而触发客户端导航后才 404。              |

> 你的示例路由已演示了 slug 校验与回退思路，但在 vite-plugin-ssr 环境下更推荐把校验移动到 onBeforeRender 阶段，而不是 `beforeEnter`。

---

### 2  数据获取与预渲染

| 场景              | 做法                                                                                                                                                                                                         |
| --------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **静态路径生成**      | 在 `pages/program/[slug]/+Page.server.ts` 里导出 `export const prerender = true` 和 `export async function onBeforeRender() { return { pageContext: { slugList } } }`；其中 `slugList` 可以从本地 JSON/YAML 或后端接口一次性拉取。 |
| **按需增量 SSG**    | 如果 Program 后续在 CMS 里动态新增，可改用 `prerender = 'auto'` 并在 CI 中只重新渲染新增 slug，避免全量 build。                                                                                                                          |
| **Pinia 与 SSR** | 将 `useCourseStore` 改为在 `onBeforeRender` 里注入初始 state；CSR 启动时用 `createPinia().use(ssrPlugin)` 复水，避免闪屏。                                                                                                       |

---

### 3  组件重构细节

* **拆分 Hero / CourseList / Sidebar 为子组件**：动态组件 `[slug].vue` 过大难测试，易失控。
* **Stage → Level 图标映射**：建议抽到 `useStageIcon(stage)` composable；方便全站复用。
* **CSS 变量**：将 `heroBackground` 写入 `style="--hero-bg: …"`，并在 SCSS 中用 `var(--hero-bg)`，避免硬编码多套渐变。

---

### 4  SEO / AEO & 架构一致性

1. **`staticPaths` 同步产出 `sitemap.xml`**：把 slug 列表复用到 sitemap 生成脚本，保证路由与索引一致。
2. **JSON-LD 生成位置**：从组件内部移动到 `onBeforeRender()`，利用服务端渲染把 `<script type="application/ld+json">` 直接注入 HTML，减少 CSR 期间的额外计算。
3. **面包屑 Schema**：你已有 `<ol class="breadcrumb">`，但建议在 SSR 阶段生成 `BreadcrumbList` JSON-LD，以提升 Rich Result 机率。

---

### 5  类型与配置文件

* **Program 配置抽离**：将 `PROGRAM_CONFIGS` 写入 `src/data/programs.ts` 或 `.yml`，并在 `onBeforeRender()` 里 `import`，同时生成静态路径。
* **Zod 校验 slug**：在 `types/index.ts` 里新增 `ProgramSlugSchema = z.enum([...])`；能在构建期捕获拼写错误。
* **i18n 预留**：若未来做多语言，可把 `name/description` 等字段改为对象 `{ zh: '', en: '' }`。

---

### 6  测试与回归

| 建议                 | 工具                                                                                                |
| ------------------ | ------------------------------------------------------------------------------------------------- |
| **E2E 校验构建后 HTML** | 用 Playwright 或 Vitest + Happy DOM，断言 `/dist/program/aigc-intermediate/index.html` 是否含正确 JSON-LD。  |
| **SSG 性能**         | 若 Program 数量未来 ≥100，建议开启并行 `prerenderConcurrency`，并在 CI 缓存 `node_modules/.cache/vite-plugin-ssr`。 |

---

## 结论

* 现有方案文件拆分、动态路由设计方向正确 。
* 为适配 **vite-plugin-ssr**，需要把**路由守卫**、**数据注入**与 **静态路径** 的逻辑前移到 `onBeforeRender()` / `prerender()`；并遵循 page-file 命名规范，才能真正享受 SSG 带来的首屏性能与 SEO 提升。
* 建议把 Program 配置、slug 枚举、类型校验三者抽象成独立模块，并利用 CI / 构建脚本同时生成 `staticPaths` 与 `sitemap.xml`，保持路由与索引的一致性。

---

### In short（简要总结）

* **路由**：改用 page-file 自动路由，slug 校验放到 `onBeforeRender()`。
* **预渲染**：在 `prerender()` 生成静态路径并静态 404；Pinia 要注入初始 state。
* **组件**：拆分子组件、CSS 变量化、抽离 Stage 图标。
* **SEO**：JSON-LD 与 Sitemap 借助 SSR 生成，面包屑亦同。
* **类型**：用 Zod 校验 slug，Program 配置单独文件化，便于扩展。
