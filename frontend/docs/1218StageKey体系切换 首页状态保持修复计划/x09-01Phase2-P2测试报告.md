# Phase 2-P2 æµ‹è¯•æŠ¥å‘Š - æµè§ˆå™¨å‰è¿›/åé€€æ”¯æŒ

**æµ‹è¯•æ—¥æœŸ**: 2025-12-19
**æµ‹è¯•å†…å®¹**: æµè§ˆå™¨å‰è¿›/åé€€æŒ‰é’®å¯¹é˜¶æ®µåˆ‡æ¢çš„æ”¯æŒ
**æµ‹è¯•ç»“æœ**: âŒ **æµ‹è¯•å¤±è´¥ - å‘ç°å…³é”®BUG**

---

## æµ‹è¯•æ¦‚è¿°

### æµ‹è¯•ç›®æ ‡
éªŒè¯æµè§ˆå™¨çš„å‰è¿›/åé€€æŒ‰é’®æ˜¯å¦èƒ½æ­£ç¡®è§¦å‘é˜¶æ®µåˆ‡æ¢ï¼Œå¹¶ä¿æŒURLã€UIã€æ•°æ®ä¸‰è€…åŒæ­¥ã€‚

### æµ‹è¯•ç¯å¢ƒ
- æµè§ˆå™¨ï¼šPlaywrightè‡ªåŠ¨åŒ–æµ‹è¯•
- å¼€å‘æœåŠ¡å™¨ï¼šhttp://localhost:5173
- æµ‹è¯•å·¥å…·ï¼špnpm dev + Playwright MCP

---

## æµ‹è¯•åœºæ™¯ä¸ç»“æœ

### TC1: å•æ­¥åé€€æµ‹è¯•

**æ“ä½œæ­¥éª¤**ï¼š
1. åˆå§‹çŠ¶æ€ï¼šé¦–é¡µé»˜è®¤"å…¥é—¨ä¸“åŒº"
2. ç‚¹å‡»"è¿›é˜¶ä¸“åŒº"æ ‡ç­¾
3. ç‚¹å‡»æµè§ˆå™¨åé€€æŒ‰é’®

**æµ‹è¯•ç»“æœ**: âŒ **FAIL**

| éªŒè¯é¡¹ | æœŸæœ›å€¼ | å®é™…å€¼ | çŠ¶æ€ |
|--------|--------|--------|------|
| URLå‚æ•° | `/` (æ— å‚æ•°) | `/` | âœ… PASS |
| Activeæ ‡ç­¾ | "å…¥é—¨ä¸“åŒº" | **"è¿›é˜¶ä¸“åŒº"** | âŒ FAIL |
| è½®æ’­å›¾å†…å®¹ | "æˆä¸ºPythonå…¨æ ˆå·¥ç¨‹å¸ˆ"ï¼ˆå…¥é—¨å†…å®¹ï¼‰ | "æˆä¸ºPythonå…¨æ ˆå·¥ç¨‹å¸ˆ" | âœ… PASS |

**æˆªå›¾è¯æ®**: `03-bug-after-back-ui-not-sync.png`

---

### TC2: å¤šæ­¥åé€€æµ‹è¯•

**æ“ä½œæ­¥éª¤**ï¼š
1. ç‚¹å‡»"è¿›é˜¶ä¸“åŒº" â†’ URL: `/?stage=intermediate`
2. ç‚¹å‡»"é«˜é˜¶ä¸“åŒº" â†’ URL: `/?stage=advanced`
3. åé€€2æ¬¡ â†’ åº”å›åˆ°å…¥é—¨ä¸“åŒº

**æµ‹è¯•ç»“æœ**: âŒ **FAIL**

**å¯¼èˆªå†å²éªŒè¯**ï¼š
- ç¬¬1æ¬¡åé€€ï¼šURLä»`?stage=advanced`åˆ°`?stage=intermediate` âœ…
- ç¬¬2æ¬¡åé€€ï¼šURLä»`?stage=intermediate`åˆ°`/`ï¼ˆå…¥é—¨ï¼‰ âœ…

**æœ€ç»ˆçŠ¶æ€**ï¼š

| éªŒè¯é¡¹ | æœŸæœ›å€¼ | å®é™…å€¼ | çŠ¶æ€ |
|--------|--------|--------|------|
| URLå‚æ•° | `/` (æ— å‚æ•°) | `/` | âœ… PASS |
| Activeæ ‡ç­¾ | "å…¥é—¨ä¸“åŒº" | **"é«˜é˜¶ä¸“åŒº"** | âŒ FAIL |
| è½®æ’­å›¾å†…å®¹ | å…¥é—¨å†…å®¹ | "ä¼ä¸šçº§DevOpså®è·µ" | âš ï¸ æ··ä¹± |

**æˆªå›¾è¯æ®**: `05-bug-after-2-backs-ui-still-advanced.png`

---

### TC3: å‰è¿›æµ‹è¯•

**æ“ä½œæ­¥éª¤**ï¼š
1. ä»TC2çš„æœ€ç»ˆçŠ¶æ€ï¼ˆURL: `/`ï¼‰
2. ç‚¹å‡»æµè§ˆå™¨å‰è¿›æŒ‰é’®1æ¬¡
3. åº”æ¢å¤åˆ°"è¿›é˜¶ä¸“åŒº"

**æµ‹è¯•ç»“æœ**: âŒ **FAIL**

| éªŒè¯é¡¹ | æœŸæœ›å€¼ | å®é™…å€¼ | çŠ¶æ€ |
|--------|--------|--------|------|
| URLå‚æ•° | `/?stage=intermediate` | `/?stage=intermediate` | âœ… PASS |
| Activeæ ‡ç­¾ | "è¿›é˜¶ä¸“åŒº" | **"é«˜é˜¶ä¸“åŒº"** | âŒ FAIL |
| è½®æ’­å›¾å†…å®¹ | "æŒæ¡å‰æ²¿AIæŠ€æœ¯"ï¼ˆè¿›é˜¶å†…å®¹ï¼‰ | "ä¼ä¸šçº§DevOpså®è·µ" | âš ï¸ æ··ä¹± |

**æˆªå›¾è¯æ®**: `06-bug-after-forward-ui-still-advanced.png`

---

## æµ‹è¯•ç»“æœæ€»ç»“

### æ•´ä½“é€šè¿‡ç‡
- æµ‹è¯•ç”¨ä¾‹æ€»æ•°ï¼š3ä¸ª
- é€šè¿‡ç”¨ä¾‹ï¼š0ä¸ª
- å¤±è´¥ç”¨ä¾‹ï¼š3ä¸ª
- **é€šè¿‡ç‡ï¼š0%** âŒ

### å…³é”®å‘ç°

#### âœ… æ­£å¸¸å·¥ä½œçš„éƒ¨åˆ†
1. **URLæ›´æ–°æ­£ç¡®**ï¼šæµè§ˆå™¨å‰è¿›/åé€€æ—¶ï¼ŒURLå‚æ•°æ­£ç¡®å˜åŒ–
2. **å†…å®¹éƒ¨åˆ†åŒæ­¥**ï¼šè½®æ’­å›¾å†…å®¹åœ¨éƒ¨åˆ†åœºæ™¯ä¸‹æ­£ç¡®æ›´æ–°
3. **è·¯ç”±å®ˆå«åŸºç¡€åŠŸèƒ½æ­£å¸¸**ï¼šé¦–æ¬¡è¿›å…¥é¡µé¢æ—¶èƒ½æ­£ç¡®è¯»å–URLå‚æ•°

#### âŒ å­˜åœ¨é—®é¢˜çš„éƒ¨åˆ†
1. **UIæ ‡ç­¾çŠ¶æ€ä¸åŒæ­¥**ï¼šæµè§ˆå™¨å‰è¿›/åé€€æ—¶ï¼ŒStageTabsçš„activeçŠ¶æ€ä¸æ›´æ–°
2. **è½®æ’­å›¾å†…å®¹æ··ä¹±**ï¼šåœ¨å¤šæ­¥å¯¼èˆªåï¼Œè½®æ’­å›¾å†…å®¹ä¸ä¸€è‡´
3. **ç”¨æˆ·ä½“éªŒæ–­è£‚**ï¼šURLå˜äº†ï¼Œä½†UIæ²¡å˜ï¼Œç”¨æˆ·ä¼šæ„Ÿåˆ°å›°æƒ‘

---

## BUGè¯¦ç»†åˆ†æ

### ğŸ› BUG #1: æµè§ˆå™¨å‰è¿›/åé€€æ—¶UIæ ‡ç­¾çŠ¶æ€ä¸åŒæ­¥

**ä¸¥é‡ç¨‹åº¦**: ğŸ”´ **P0 - ä¸¥é‡é˜»å¡**

**å½±å“èŒƒå›´**: é¦–é¡µé˜¶æ®µåˆ‡æ¢åŠŸèƒ½çš„æ ¸å¿ƒç”¨æˆ·ä½“éªŒ

**å¤ç°æ­¥éª¤**ï¼š
1. ç‚¹å‡»ä»»æ„é˜¶æ®µæ ‡ç­¾ï¼ˆå¦‚"è¿›é˜¶ä¸“åŒº"ï¼‰
2. ç‚¹å‡»æµè§ˆå™¨åé€€æŒ‰é’®
3. è§‚å¯Ÿï¼šURLå˜åŒ–äº†ï¼Œä½†æ ‡ç­¾activeçŠ¶æ€æœªæ›´æ–°

**æ ¹æœ¬åŸå› **ï¼š

Vue Routerçš„`beforeEnter`é’©å­**ä»…åœ¨é¦–æ¬¡è¿›å…¥è·¯ç”±æ—¶è§¦å‘**ã€‚å½“æµè§ˆå™¨å‰è¿›/åé€€å¯¼è‡´URLä»`/?stage=intermediate`å˜ä¸º`/`æ—¶ï¼š

```
ç”¨æˆ·æ“ä½œ         â†’  URLå˜åŒ–         â†’  è·¯ç”±äº‹ä»¶           â†’  Storeæ›´æ–°  â†’  UIæ›´æ–°
æµè§ˆå™¨åé€€       â†’  /?stage=...â†’/  â†’  âŒ beforeEnter    â†’  âŒ æœªè§¦å‘   â†’  âŒ å¤±è´¥
                                      ä¸è§¦å‘ï¼ˆåŒä¸€è·¯ç”±ï¼‰
```

**å…³é”®ä»£ç ä½ç½®**ï¼š
- `/frontend/src/router/index.ts:13-27` - è·¯ç”±å®ˆå«ï¼ˆåªåœ¨é¦–æ¬¡è¿›å…¥æ—¶è§¦å‘ï¼‰
- `/frontend/src/components/CampSection.vue:298-303` - watchç›‘å¬storeï¼ˆä¾èµ–storeæ›´æ–°ï¼‰
- `/frontend/src/components/StageTabs.vue:52` - activeçŠ¶æ€è®¡ç®—ï¼ˆä»propsè·å–ï¼‰

**ä¸ºä»€ä¹ˆä¼šå¤±è´¥**ï¼š
1. æµè§ˆå™¨åé€€æ—¶ï¼ŒURLä»`/?stage=intermediate`å˜ä¸º`/`
2. ä»ç„¶åœ¨åŒä¸€ä¸ªè·¯ç”±ï¼ˆhomeè·¯ç”±ï¼‰å†…ï¼Œåªæ˜¯queryå‚æ•°å˜åŒ–
3. `beforeEnter`é’©å­ä¸ä¼šè§¦å‘ï¼ˆå› ä¸ºæ²¡æœ‰è¿›å…¥/ç¦»å¼€è·¯ç”±ï¼‰
4. `courseStore.currentStage`æ²¡æœ‰æ›´æ–°
5. CampSectionçš„watchç›‘å¬åˆ°storeæœªå˜åŒ–ï¼Œä¸æ›´æ–°æœ¬åœ°`currentStage`
6. StageTabsçš„`modelValue` propæ²¡æœ‰æ›´æ–°
7. ActiveçŠ¶æ€ä»ç„¶æ˜¯æ—§å€¼

---

## è§£å†³æ–¹æ¡ˆ

### ğŸ”§ ä¿®å¤æ–¹æ¡ˆï¼šç›‘å¬route.queryå˜åŒ–

**æ–¹æ¡ˆæè¿°**ï¼š
åœ¨CampSectionç»„ä»¶å†…æ·»åŠ å¯¹route.query.stageçš„ç›‘å¬ï¼Œç›´æ¥å“åº”URLå‚æ•°å˜åŒ–ã€‚

**å®ç°ä»£ç **ï¼š

```typescript
// åœ¨ CampSection.vue çš„ script setup ä¸­æ·»åŠ 
import { useRoute } from 'vue-router'

const route = useRoute()

// ç›‘å¬URL queryå‚æ•°å˜åŒ–ï¼ˆå¤„ç†æµè§ˆå™¨å‰è¿›/åé€€ï¼‰
watch(
  () => route.query.stage,
  (newStage) => {
    if (newStage && StageKeySchema.safeParse(newStage).success) {
      // URLæœ‰æœ‰æ•ˆçš„stageå‚æ•°ï¼Œæ›´æ–°store
      courseStore.setCurrentStageOnly(newStage as StageKey)
      console.log(`[CampSection] URLå‚æ•°å˜åŒ–ï¼Œæ›´æ–°é˜¶æ®µ: ${newStage}`)
    } else {
      // URLæ²¡æœ‰stageå‚æ•°ï¼Œæ¢å¤é»˜è®¤å€¼
      courseStore.setCurrentStageOnly('beginner')
      console.log('[CampSection] URLæ— stageå‚æ•°ï¼Œæ¢å¤é»˜è®¤é˜¶æ®µ: beginner')
    }
  },
  { immediate: false } // ä¸ç«‹å³æ‰§è¡Œï¼Œé¿å…åˆå§‹åŒ–æ—¶é‡å¤
)
```

**ä¿®å¤ä½ç½®**ï¼š
`/frontend/src/components/CampSection.vue` - åœ¨ç°æœ‰watché€»è¾‘ä¹‹åæ·»åŠ 

**ä¿®å¤åŸç†**ï¼š
1. âœ… ç›´æ¥ç›‘å¬route.query.stageçš„å˜åŒ–
2. âœ… æ— è®ºæ˜¯ç”¨æˆ·ç‚¹å‡»è¿˜æ˜¯æµè§ˆå™¨å‰è¿›/åé€€ï¼Œéƒ½èƒ½å“åº”
3. âœ… æ›´æ–°storeåï¼Œç°æœ‰çš„watché“¾ä¼šè‡ªåŠ¨åŒæ­¥UI

**æ•°æ®æµ**ï¼š
```
æµè§ˆå™¨å‰è¿›/åé€€  â†’  URLå˜åŒ–(route.query)  â†’  watchè§¦å‘  â†’  æ›´æ–°store  â†’  ç°æœ‰watché“¾  â†’  UIæ›´æ–°
```

---

## é¢„æœŸä¿®å¤åçš„æ•ˆæœ

### ä¿®å¤åçš„æµ‹è¯•é¢„æœŸ

**TC1: å•æ­¥åé€€æµ‹è¯•**
- URL: `/` âœ…
- Activeæ ‡ç­¾: "å…¥é—¨ä¸“åŒº" âœ…ï¼ˆä¿®å¤åï¼‰
- è½®æ’­å›¾: å…¥é—¨å†…å®¹ âœ…

**TC2: å¤šæ­¥åé€€æµ‹è¯•**
- URL: `/` âœ…
- Activeæ ‡ç­¾: "å…¥é—¨ä¸“åŒº" âœ…ï¼ˆä¿®å¤åï¼‰
- è½®æ’­å›¾: å…¥é—¨å†…å®¹ âœ…ï¼ˆä¿®å¤åï¼‰

**TC3: å‰è¿›æµ‹è¯•**
- URL: `/?stage=intermediate` âœ…
- Activeæ ‡ç­¾: "è¿›é˜¶ä¸“åŒº" âœ…ï¼ˆä¿®å¤åï¼‰
- è½®æ’­å›¾: è¿›é˜¶å†…å®¹ âœ…ï¼ˆä¿®å¤åï¼‰

### ç”¨æˆ·ä½“éªŒæ”¹è¿›

**ä¿®å¤å‰**ï¼š
- ğŸ˜µ URLå˜äº†ï¼Œä½†æ ‡ç­¾è¿˜æ˜¯æ—§çš„ï¼Œç”¨æˆ·å›°æƒ‘
- ğŸ˜µ è½®æ’­å›¾å†…å®¹å’Œæ ‡ç­¾ä¸åŒ¹é…ï¼Œä½“éªŒæ–­è£‚
- ğŸ˜µ æ— æ³•é€šè¿‡æµè§ˆå™¨å‰è¿›/åé€€æ­£å¸¸å¯¼èˆª

**ä¿®å¤å**ï¼š
- âœ… URLã€æ ‡ç­¾ã€å†…å®¹å®Œå…¨åŒæ­¥
- âœ… æµè§ˆå™¨å‰è¿›/åé€€æŒ‰é’®æ­£å¸¸å·¥ä½œ
- âœ… ç”¨æˆ·ä½“éªŒæµç•…ï¼Œç¬¦åˆé¢„æœŸ

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³æ‰§è¡Œï¼ˆP0ä¼˜å…ˆçº§ï¼‰

1. **ä¿®å¤BUG**ï¼šæŒ‰ç…§è§£å†³æ–¹æ¡ˆæ·»åŠ route.queryç›‘å¬
2. **éªŒè¯ä¿®å¤**ï¼šé‡æ–°è¿è¡ŒTC1-TC3æµ‹è¯•åœºæ™¯
3. **è¡¥å……æµ‹è¯•**ï¼šæµ‹è¯•è¾¹ç•Œæƒ…å†µï¼ˆæ— æ•ˆstageå‚æ•°ã€ç©ºå€¼ç­‰ï¼‰
4. **æäº¤ä»£ç **ï¼šåˆ›å»ºcommitè®°å½•æ­¤æ¬¡ä¿®å¤

### åç»­ä¼˜åŒ–ï¼ˆP1ä¼˜å…ˆçº§ï¼‰

1. **æ·»åŠ å•å…ƒæµ‹è¯•**ï¼šä¸ºroute.queryç›‘å¬æ·»åŠ æµ‹è¯•è¦†ç›–
2. **å®Œå–„æ–‡æ¡£**ï¼šæ›´æ–°å¼€å‘æ–‡æ¡£è¯´æ˜è·¯ç”±å‚æ•°ç›‘å¬æœºåˆ¶
3. **æ€§èƒ½ç›‘æ§**ï¼šç¡®è®¤watchæ€§èƒ½å½±å“å¯æ¥å—

---

## æŠ€æœ¯å€ºåŠ¡è®°å½•

### éœ€è¦æ³¨æ„çš„ç‚¹

1. **åŒé‡watchæœºåˆ¶**ï¼š
   - `watch(currentStage)` - ç»„ä»¶å†…éƒ¨ â†’ store
   - `watch(() => courseStore.currentStage)` - store â†’ ç»„ä»¶å†…éƒ¨
   - `watch(() => route.query.stage)` - **æ–°å¢**ï¼šURL â†’ store

   éœ€è¦ç¡®ä¿è¿™ä¸‰ä¸ªwatchä¸ä¼šå¯¼è‡´å¾ªç¯è§¦å‘ã€‚

2. **immediateé€‰é¡¹**ï¼š
   æ–°å¢çš„route.query watchä½¿ç”¨`immediate: false`ï¼Œé¿å…åˆå§‹åŒ–æ—¶é‡å¤æ›´æ–°ã€‚

3. **é»˜è®¤å€¼å¤„ç†**ï¼š
   å½“URLæ²¡æœ‰stageå‚æ•°æ—¶ï¼Œæ˜ç¡®æ¢å¤ä¸º'beginner'ï¼Œä¿æŒè¡Œä¸ºä¸€è‡´ã€‚

---

## é™„å½•ï¼šæµ‹è¯•æˆªå›¾

1. **03-bug-after-back-ui-not-sync.png** - TC1å•æ­¥åé€€å¤±è´¥è¯æ®
2. **05-bug-after-2-backs-ui-still-advanced.png** - TC2å¤šæ­¥åé€€å¤±è´¥è¯æ®
3. **06-bug-after-forward-ui-still-advanced.png** - TC3å‰è¿›å¤±è´¥è¯æ®

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-12-19
**æŠ¥å‘Šç”Ÿæˆäºº**: Claude Code
**å®¡æ ¸çŠ¶æ€**: å¾…å®¡æ ¸
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
